config:
  target: "http://localhost:3000"
  phases:
    - duration: 30
      arrivalRate: 5
      name: "rps 5"
    - duration: 30
      arrivalRate: 10
      name: "rps 10"
    - duration: 30
      arrivalRate: 20
      name: "rps 20"
    - duration: 30
      arrivalRate: 30
      name: "rps 30"
    - duration: 30
      arrivalRate: 40
      name: "rps 40"
    - duration: 30
      arrivalRate: 50
      name: "rps 50"
  http:
    pool: 200        # Reutiliza conexões (keep-alive)
    timeout: 10      # Timeout curto para detectar travamentos
  plugins:
    ensure: {}

# Critérios automáticos de quebra (opcional)
ensure:
  - "errors.rate < 0.01"                 # menos de 1% de erro
  - "http.response_time.p95 < 5000"      # p95 menor que 5s
  - "http.codes.200 > 0"                 # tem que retornar 200

scenarios:
  - name: "CRUD de livros"
    flow:
      - get:
          url: "/livros"
      - post:
          url: "/livros"
          json:
            titulo: "Livro dia do estudante"
            autor: "Artillery"
            ano_publicacao: 2025
            genero: "Aventura"
            preco: 150.85
          capture:
            - json: "$.livro.id"
              as: "livroId"
      - get:
          url: "/livros/{{ livroId }}"
          capture:
            - json: "$.livro.titulo"
              as: "livroTitulo"
      - put:
          url: "/livros/{{ livroId }}"
          json:
            titulo: "Livro dia do estudante o retorno"
            autor: "Joel Santos"
            ano_publicacao: 2023
            genero: "Terror"
            preco: 250.85
      - delete:
          url: "/livros/{{ livroId }}"
      - get:
          url: "/livros/busca?titulo={{ livroTitulo }}"
